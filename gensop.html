<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Sopa de Letras</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Permanent+Marker&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f4f7f9;
        }
        /* Estilo espec√≠fico para la cuadr√≠cula */
        .grid-container {
            display: grid;
            border: 2px solid #000000; /* Borde negro */
            background-color: #ffffff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-radius: 0.75rem; /* Esquinas redondeadas */
            overflow: hidden; /* Asegura que el contenido interno respete el borde redondeado */
        }
        .grid-cell {
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 0.7rem; /* Tama√±o de fuente ligeramente reducido */
            font-weight: 600;
            color: #1f2937;
            padding: 0.1rem; /* A√±ade un poco de espacio alrededor de la letra, separ√°ndola del borde */
            user-select: none;
            cursor: default;
        }

        /* Estilo para el t√≠tulo de la sopa */
        #outputTitle {
            font-family: 'Permanent Marker', cursive;
            font-size: 1.8rem; /* Tama√±o ligeramente m√°s reducido */
            letter-spacing: 0.1em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        /* √çcono de Checklist - Tama√±o para vista de pantalla */
        .word-list-icon {
            height: 0.625rem; /* 10px */
            width: 0.625rem;  /* 10px */
        }

        /* Ocultar elementos y optimizar layout en la vista de impresi√≥n */
        @media print {
            /* Oculta los controles */
            .no-print {
                display: none !important;
            }
            
            /* Ajusta el cuerpo para que no tenga m√°rgenes */
            body {
                margin: 0 !important;
                padding: 0 !important;
            }

            /* Asegura que el √°rea imprimible use todo el espacio sin padding */
            .printable-area {
                margin: 0 !important;
                padding: 0.5rem !important; /* M√≠nimo padding para evitar recortes en algunos navegadores */
                box-shadow: none !important;
                max-width: none !important;
                width: 100% !important;
                border: none !important;
            }

            /* Ajustes para la cuadr√≠cula en impresi√≥n */
            .grid-container {
                border-width: 1px; /* Borde m√°s fino para impresi√≥n */
                border-color: #000;
                border-radius: 0.5rem;
            }
            .grid-cell {
                font-size: 0.5rem !important; /* Tama√±o de letra m√°s peque√±o para m√°xima densidad */
                height: auto;
                padding: 0.5px; 
                line-height: 1; 
            }
            
            /* Ajustes de tipograf√≠a en impresi√≥n */
            #outputTitle {
                font-size: 1.5rem !important;
                margin-bottom: 0.75rem !important;
            }
            #wordListOutput {
                margin-top: 0.75rem !important;
                font-size: 0.7rem !important; /* Tama√±o de lista muy peque√±o */
            }

            /* Ajustes para el √≠cono de checklist en impresi√≥n */
            .word-list-icon {
                height: 0.5rem !important;
                width: 0.5rem !important;
                border-width: 1px !important;
            }
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <div id="app" class="max-w-4xl mx-auto bg-white p-6 sm:p-10 rounded-xl shadow-2xl">

        <!-- √Årea de Control (No Imprimir) --><div class="no-print">
            <h1 class="text-3xl font-bold text-gray-800 mb-6 border-b pb-2">üß© Generador de Sopa de Letras</h1>
            <p class="text-sm text-gray-600 mb-6">Ingresa un t√≠tulo, a√±ade palabras y presiona "Generar Sopa" para crear tu puzzle. Luego usa el bot√≥n de la impresora para descargar.</p>

            <!-- Inputs --><div class="space-y-4 mb-8 p-4 bg-gray-50 rounded-lg border">
                <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                    <input type="text" id="puzzleTitle" placeholder="T√≠tulo de la Sopa de Letras (Ej: Frutas)"
                        class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm shadow-sm"
                        value="Mi Sopa de Letras Personalizada">
                    
                    <select id="gridSize"
                        class="p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm shadow-sm w-full sm:w-auto">
                        <option value="15">Tama√±o 15x15</option>
                        <option value="20" selected>Tama√±o 20x20</option>
                        <option value="25">Tama√±o 25x25</option>
                    </select>
                </div>

                <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                    <input type="text" id="wordInput" placeholder="Escribe una palabra y presiona Enter o A√±adir"
                        class="flex-1 p-3 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 text-sm shadow-sm">
                    <button id="addWordBtn"
                        class="px-4 py-3 bg-indigo-600 text-white font-semibold rounded-lg shadow-md hover:bg-indigo-700 transition duration-150 transform hover:scale-105">
                        A√±adir Palabra
                    </button>
                </div>

                <!-- Lista de Palabras A√±adidas --><div id="wordListDisplay" class="flex flex-wrap gap-2 min-h-8 p-2 border border-dashed rounded-lg bg-white">
                    <p class="text-gray-400 italic text-sm" id="emptyMessage">A√∫n no has a√±adido palabras.</p>
                </div>
            </div>

            <!-- Botones de Acci√≥n --><div class="flex flex-col sm:flex-row justify-between space-y-4 sm:space-y-0 sm:space-x-4 mb-10">
                <button id="generateBtn"
                    class="w-full sm:w-1/2 px-6 py-3 bg-blue-600 text-white font-bold text-lg rounded-xl shadow-lg hover:bg-blue-700 transition duration-200 transform hover:scale-[1.02] active:scale-95">
                    Generar Sopa de Letras
                </button>
                <button id="printBtn"
                    class="w-full sm:w-1/2 px-6 py-3 bg-green-500 text-white font-bold text-lg rounded-xl shadow-lg hover:bg-green-600 transition duration-200 transform hover:scale-[1.02] active:scale-95 disabled:bg-gray-400 flex items-center justify-center"
                    disabled>
                    <span class="text-2xl" aria-hidden="true">üñ®Ô∏è</span>
                    <span class="sr-only">Imprimir / Descargar PDF</span>
                </button>
            </div>
            
        </div>

        <!-- √Årea Imprimible (Resultado) --><div id="printableArea" class="printable-area p-4 sm:p-6 rounded-xl border border-gray-200" style="display: none;">
            <h1 id="outputTitle" class="text-2xl sm:text-3xl font-extrabold text-center mb-6 text-gray-900 uppercase"></h1>
            
            <div id="puzzleOutput" class="mx-auto w-full aspect-square" style="max-width: 600px;">
                <!-- Aqu√≠ se renderizar√° la cuadr√≠cula --></div>
            
            <!-- Lista de Palabras --><div id="wordListOutput" class="text-sm text-gray-600 grid grid-cols-2 sm:grid-cols-3 gap-x-6 gap-y-2 mt-8 pl-4">
                <!-- Aqu√≠ se renderizar√° la lista de palabras --></div>
        </div>

        <!-- √Årea de Mensajes --><div id="messageBox" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden">
            <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
                <p id="messageText" class="text-lg font-semibold text-gray-800 mb-4"></p>
                <button id="closeMessageBtn" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition">Entendido</button>
            </div>
        </div>

    </div>

    <script type="module">
        // =========================================================================
        // Configuraci√≥n y Variables Globales
        // =========================================================================
        const wordList = [];
        // Alfabeto extendido para incluir √ë y vocales acentuadas
        const alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ√ë√Å√â√ç√ì√ö'; 
        const DIRECTIONS = [
            [0, 1],   // Este (E)
            [1, 0],   // Sur (S)
            [0, -1],  // Oeste (W)
            [-1, 0],  // Norte (N)
            [1, 1],   // Sureste (SE)
            [-1, 1],  // Noreste (NE)
            [1, -1],  // Suroeste (SW)
            [-1, -1]  // Noroeste (NW)
        ];

        // Referencias a elementos del DOM
        const wordInput = document.getElementById('wordInput');
        const wordListDisplay = document.getElementById('wordListDisplay');
        const emptyMessage = document.getElementById('emptyMessage');
        const puzzleTitle = document.getElementById('puzzleTitle');
        const generateBtn = document.getElementById('generateBtn');
        const printBtn = document.getElementById('printBtn');
        const puzzleOutput = document.getElementById('puzzleOutput');
        const outputTitle = document.getElementById('outputTitle');
        const wordListOutput = document.getElementById('wordListOutput');
        const gridSizeSelect = document.getElementById('gridSize');
        const printableArea = document.getElementById('printableArea');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const closeMessageBtn = document.getElementById('closeMessageBtn');
        
        // =========================================================================
        // L√≥gica de UI - Mensajes y Palabras
        // =========================================================================
        
        function showMessage(text) {
            messageText.textContent = text;
            messageBox.classList.remove('hidden');
        }

        closeMessageBtn.addEventListener('click', () => {
            messageBox.classList.add('hidden');
        });

        function formatWord(word) {
            // Limpia y convierte a may√∫sculas. Ahora permite √ë y vocales acentuadas.
            return word.toUpperCase().replace(/[^A-Z√ë√Å√â√ç√ì√ö]/g, '');
        }

        function addWord() {
            let word = wordInput.value.trim();
            if (word.length === 0) {
                showMessage("Por favor, introduce una palabra v√°lida.");
                return;
            }

            const cleanWord = formatWord(word);
            const maxLen = parseInt(gridSizeSelect.value);

            if (cleanWord.length === 0) {
                showMessage("La palabra solo debe contener letras (A-Z, √ë, √Å, √â, √ç, √ì, √ö).");
                return;
            }

            if (cleanWord.length > maxLen) {
                showMessage(`La palabra es demasiado larga (${cleanWord.length} letras). El tama√±o m√°ximo actual de la cuadr√≠cula es ${maxLen}x${maxLen}.`);
                return;
            }

            if (wordList.includes(cleanWord)) {
                showMessage("Esta palabra ya ha sido a√±adida.");
                return;
            }

            wordList.push(cleanWord);
            wordInput.value = '';
            renderWordListDisplay();
            
            // Habilitar el bot√≥n de generar si hay palabras
            generateBtn.disabled = false;
        }

        function removeWord(wordToRemove) {
            const index = wordList.indexOf(wordToRemove);
            if (index > -1) {
                wordList.splice(index, 1);
            }
            renderWordListDisplay();

            if (wordList.length === 0) {
                generateBtn.disabled = true;
                printBtn.disabled = true;
                printableArea.style.display = 'none';
            }
        }

        function renderWordListDisplay() {
            wordListDisplay.innerHTML = '';
            if (wordList.length === 0) {
                wordListDisplay.appendChild(emptyMessage);
                emptyMessage.classList.remove('hidden');
            } else {
                emptyMessage.classList.add('hidden');
                wordList.forEach(word => {
                    const tag = document.createElement('span');
                    tag.className = 'flex items-center bg-blue-100 text-blue-800 text-sm font-medium px-3 py-1 rounded-full cursor-pointer hover:bg-red-200 transition duration-150';
                    tag.innerHTML = `${word} <button class="ml-2 text-red-500 hover:text-red-700 font-bold leading-none" data-word="${word}">&times;</button>`;
                    tag.querySelector('button').addEventListener('click', (e) => removeWord(e.target.dataset.word));
                    wordListDisplay.appendChild(tag);
                });
            }
        }

        // =========================================================================
        // Algoritmo de Generaci√≥n de Sopa de Letras
        // =========================================================================

        function createEmptyGrid(size) {
            return Array.from({ length: size }, () => Array(size).fill(''));
        }

        function placeWord(grid, word, size) {
            // Intentar colocar la palabra 500 veces antes de rendirse
            for (let attempts = 0; attempts < 500; attempts++) {
                const startX = Math.floor(Math.random() * size);
                const startY = Math.floor(Math.random() * size);
                const [dx, dy] = DIRECTIONS[Math.floor(Math.random() * DIRECTIONS.length)];
                
                let fits = true;
                
                // 1. Verificar si cabe
                if (startX + word.length * dx < 0 || startX + word.length * dx > size ||
                    startY + word.length * dy < 0 || startY + word.length * dy > size) {
                    continue; // No cabe en esta direcci√≥n
                }

                // 2. Verificar si no hay conflicto
                for (let i = 0; i < word.length; i++) {
                    const x = startX + i * dx;
                    const y = startY + i * dy;
                    
                    if (grid[x][y] !== '' && grid[x][y] !== word[i]) {
                        fits = false;
                        break;
                    }
                }

                // 3. Colocar la palabra
                if (fits) {
                    for (let i = 0; i < word.length; i++) {
                        const x = startX + i * dx;
                        const y = startY + i * dy;
                        grid[x][y] = word[i];
                    }
                    return true;
                }
            }
            return false; // No se pudo colocar la palabra
        }

        function generatePuzzle(words, size) {
            const grid = createEmptyGrid(size);
            const placedWords = [];

            // Ordenar las palabras de mayor a menor longitud para un mejor empaquetamiento
            const sortedWords = [...words].sort((a, b) => b.length - a.length);

            sortedWords.forEach(word => {
                if (word.length <= size) {
                    if (placeWord(grid, word, size)) {
                        placedWords.push(word);
                    } else {
                        console.warn(`No se pudo colocar la palabra: ${word}`);
                    }
                }
            });

            // Rellenar espacios vac√≠os
            for (let i = 0; i < size; i++) {
                for (let j = 0; j < size; j++) {
                    if (grid[i][j] === '') {
                        grid[i][j] = alphabet.charAt(Math.floor(Math.random() * alphabet.length));
                    }
                }
            }
            
            // Devolver la cuadr√≠cula y las palabras que realmente se colocaron
            return { grid, placedWords };
        }

        // =========================================================================
        // L√≥gica de Renderizado
        // =========================================================================

        function renderPuzzle(grid, placedWords, title) {
            const size = grid.length;
            
            outputTitle.textContent = title.toUpperCase() || "SOPA DE LETRAS";
            
            // 1. Renderizar la cuadr√≠cula
            puzzleOutput.innerHTML = '';
            puzzleOutput.style.gridTemplateColumns = `repeat(${size}, 1fr)`;
            puzzleOutput.className = 'grid-container mx-auto w-full aspect-square'; // Reset classes for dynamic sizing
            
            grid.forEach(row => {
                row.forEach(letter => {
                    const cell = document.createElement('div');
                    cell.className = 'grid-cell';
                    cell.textContent = letter;
                    puzzleOutput.appendChild(cell);
                });
            });

            // 2. Renderizar la lista de palabras (con checklist)
            wordListOutput.innerHTML = '';
            placedWords.sort().forEach(word => {
                const item = document.createElement('div');
                // Clase ajustada a text-xs para que el texto sea m√°s peque√±o
                item.className = 'flex items-center text-xs font-semibold tracking-wider text-gray-800 space-x-2'; 
                // √çcono de checklist redondo (usando la clase word-list-icon definida en CSS)
                item.innerHTML = `<span class="word-list-icon border-2 border-gray-500 rounded-full flex-shrink-0"></span><span>${word}</span>`;
                wordListOutput.appendChild(item);
            });
            
            printableArea.style.display = 'block';
        }

        // =========================================================================
        // Manejadores de Eventos
        // =========================================================================

        document.getElementById('addWordBtn').addEventListener('click', addWord);
        
        wordInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                addWord();
            }
        });

        generateBtn.addEventListener('click', () => {
            if (wordList.length === 0) {
                showMessage("Debes a√±adir al menos una palabra para generar la sopa.");
                return;
            }
            
            generateBtn.disabled = true;
            generateBtn.textContent = 'Generando...';

            // Peque√±o timeout para que el UI se actualice y parezca que hay un proceso (aunque es casi instant√°neo)
            setTimeout(() => {
                const size = parseInt(gridSizeSelect.value);
                const title = puzzleTitle.value.trim();
                const { grid, placedWords } = generatePuzzle(wordList, size);

                if (placedWords.length === 0 && wordList.length > 0) { // Solo mostrar si se intentaron a√±adir palabras
                    showMessage("Advertencia: No se pudo colocar ninguna palabra en la cuadr√≠cula. Intenta con un tama√±o mayor, palabras m√°s cortas o menos palabras.");
                }

                renderPuzzle(grid, placedWords, title);
                printBtn.disabled = false;
                generateBtn.disabled = false;
                generateBtn.textContent = 'Generar Sopa de Letras';
            }, 100);
        });

        printBtn.addEventListener('click', () => {
            // Esta funci√≥n ejecuta el di√°logo de impresi√≥n del navegador, que es el equivalente a Ctrl + P.
            window.print();
        });

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            renderWordListDisplay();
            generateBtn.disabled = true; // Deshabilitar hasta que se a√±adan palabras
        });

        // Asegurar que al cambiar el tama√±o del grid, las palabras se validan y se resetea la salida
        gridSizeSelect.addEventListener('change', () => {
            // Filtra palabras que excedan el nuevo tama√±o
            const newSize = parseInt(gridSizeSelect.value);
            let needsRemoval = false;

            for (let i = wordList.length - 1; i >= 0; i--) {
                if (wordList[i].length > newSize) {
                    wordList.splice(i, 1);
                    needsRemoval = true;
                }
            }

            if (needsRemoval) {
                renderWordListDisplay();
                showMessage(`Se han eliminado autom√°ticamente las palabras que exced√≠an el tama√±o m√°ximo de ${newSize}x${newSize}.`);
            }

            printableArea.style.display = 'none';
            printBtn.disabled = true;
            if (wordList.length > 0) {
                generateBtn.disabled = false;
            }
        });

    </script>
</body>
</html>